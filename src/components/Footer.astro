---
import StarlightFooter from '@astrojs/starlight/components/Footer.astro';
import DisclaimerModal from './DisclaimerModal.svelte';
import childProcess from 'child_process';

const hash = childProcess.execSync('git rev-parse --short HEAD').toString().trim();

const t = Astro.locals.t;
const disclaimerStrings = {
	title: t('disclaimer.title'),
	independence: t('disclaimer.independence'),
	goal: t('disclaimer.goal'),
	openSource: t('disclaimer.openSource'),
	wrongPlace: t('disclaimer.wrongPlace'),
	visitOfficial: t('disclaimer.visitOfficial'),
	continue: t('disclaimer.continue'),
};
---

<StarlightFooter />
<DisclaimerModal client:load strings={disclaimerStrings} />
<div class="footer-bottom">
	<div class="disclaimer">
		<p>
			{t('footer.independence')}
			<a href="https://resonite.com/" class="link-styled" target="_blank" rel="noopener"
				>{t('footer.resonite')}</a
			>
			{t('footer.or')}
			<a href="https://yellowdogman.com/" class="link-styled" target="_blank" rel="noopener"
				>{t('footer.yellowdog')}</a
			>
			{t('footer.learnMoreText')}
			<a type="button" class="link-styled" id="learn-more-btn">{t('disclaimer.learnMore')}</a>
		</p>
		<p>
			{t('footer.buildVersion')}
			<a
				href={`https://github.com/ResoniteModding/Docs/commit/${hash}`}
				class="link-styled"
				target="_blank"
				rel="noopener">{hash}</a
			>
		</p>
	</div>
</div>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const learnMoreBtn = document.getElementById('learn-more-btn');
		if (learnMoreBtn) {
			learnMoreBtn.addEventListener('click', () => {
				window.dispatchEvent(new CustomEvent('open-disclaimer-modal'));
			});
		}
	});
</script>

<style>
	.footer-bottom {
		display: flex;
		flex-direction: column;
		align-items: center;
		text-align: center;
		border-top: 1px solid var(--sl-color-gray-5);
		padding-top: 1.5rem;
	}

	.disclaimer {
		line-height: 1.8;
	}

	.disclaimer p {
		font-size: var(--sl-text-sm);
		color: var(--sl-color-gray-3);
	}

	.link-styled {
		color: var(--sl-color-accent);
		text-decoration: none;
		transition: all 0.2s ease;
		border-bottom: 1px solid transparent;
		cursor: pointer;
	}

	.link-styled:hover {
		color: var(--sl-color-accent-high);
		border-bottom-color: var(--sl-color-accent);
	}
</style>
